<link rel="import" href="../polymer-channels-card/polymer-channels-card.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<dom-module id="carls-first-card-composer">


   <template>
    <style>
      .container {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        padding: 10px 3px;
      }
      .flex {
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      }
      .buttonPanel {
        padding-left: 15px;
      }
      input {
        outline: none;
        width: 100%;
        box-sizing: border-box;
        border: none;
        border-bottom: 3px solid #e5e5e5;
        background: transparent;
        font-size: 16px;
        font-weight: 300;
        font-family: "Roboto", sans-serif;
        padding: 10px 5px;
        color: #000;
      }
    </style>
    <div class="container">
      <div class="flex" style="position: relative;">
        <input id="txt" placeholder="Enter your question" on-keydown="onKeydown">
      </div>
      <div class="buttonPanel">
        <paper-button on-click="onSend" raised>Send</button>
      </div>
    </div>
  </template>
  <script>
    class CarlsFirstCardComposer extends PolymerChannelsCardComposer {
      static get is() { return 'carls-first-card-composer'; }
      onKeydown(event) {
        if (event.keyCode === 13) {
          this.onSend();
        }
      }
      onSend() {
        const message = this.$.txt.value.trim();
        if (message.length > 0) {
          this.send({ question: message, items: [] });
          this.$.txt.value = '';
        }
      }
    }
    window.customElements.define(CarlsFirstCardComposer.is, CarlsFirstCardComposer);
  </script> 
</dom-module>

<dom-module id="carls-first-card-viewer">
  <template>
    <style>
      .container {
        border: 1px solid #ccc;
        padding: 4px;
      }
      .question {
        font-size: 125%;
        margin: 0 0 5px 30px;
      }
      .listItem {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        padding: 3px;
      }
      .flex {
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      }
      .checkContainer {
        cursor: pointer;
        margin: 0 5px 0 0;
        vertical-align: top;
      }
      .messageContainer {
        vertical-align: top;
      }
      .votesContainer {
        margin: 0 0 0 10px;
        vertical-align: top;
      }
      .entryContainer {
        margin: 5px 10px 5px 30px;
        position: relative;
      }
      #entryText {
        width: 100%;
        font-size: 14px;
      }
    </style>
    <div class="container">
      <div class="question">{{data.question}}</div>
      <div class="innerContainer">
        <template is="dom-repeat" items="{{data.items}}">
          <div class="listItem">
            <div class="checkContainer">
              <iron-icon icon="[[getCheckboxIcon(item.checked)]]" on-click="onItemCheckboxClick"></iron-icon>
            </div>
            <div class="messageContainer">{{item.option}}</div>
            <div class="votesContainer">{{item.votes}}</div>
          </div>
        </template>
      </div>
      <div class="entryContainer">
        <input id="entryText" type="text" placeholder="Enter new option and hit ENTER" on-keydown="onEntryKeyDown">
      </div>
    </div>
  </template>
  <script>
    class CarlsFirstCardViewer extends PolymerChannelsCardViewer {
      static get is() { return 'carls-first-card-viewer'; }
      getCheckboxIcon(isChecked) {
        return isChecked ? "icons:check" : "icons:check-box-outline-blank";
      }
      onEntryKeyDown(event) {
        if (event.keyCode === 13) {
          const text = this.$.entryText.value.trim();
          if (text.length > 0) {
            this.stateController.arrayInsert("items", { option: text, votes: 0 }).then(() => {
              this.$.entryText.value = '';
            });
          }
        }
      }
      onItemCheckboxClick(event) {
        event.model.item.checked = !event.model.item.checked;
        if (event.model.item.checked) {
          this.stateController.arrayElementUpdate('items', event.model.item.id, "votes", event.model.item.votes + 1);
        } else {
          this.stateController.arrayElementUpdate('items', event.model.item.id, "votes", event.model.item.votes - 1);
        }
      }
    }
    window.customElements.define(CarlsFirstCardViewer.is, CarlsFirstCardViewer);
  </script>
</dom-module>


